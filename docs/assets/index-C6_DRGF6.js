(function(){const v=document.createElement("link").relList;if(v&&v.supports&&v.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))I(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const y of i.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&I(y)}).observe(document,{childList:!0,subtree:!0});function E(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function I(s){if(s.ep)return;s.ep=!0;const i=E(s);fetch(s.href,i)}})();(()=>{const _=document.getElementById("fLoginUsername"),v=document.getElementById("fLoginSubmit"),E=document.getElementById("toc"),I=document.getElementById("catCounter"),s=document.getElementById("fAdd"),i=document.getElementById("fAddTitle"),y=document.getElementById("fAddUrl"),V=document.getElementById("fAddSubmit"),A=document.getElementById("fSearch"),h=document.getElementById("tblGallery").querySelector("tbody"),J=document.getElementById("tmpCard"),q=document.getElementById("tmpCategory"),M=document.getElementById("admin"),Q=document.getElementById("tmpAdminTable"),W=document.getElementById("tmpAdminRow"),T=document.getElementById("modal"),C=document.getElementById("mdlMsg"),X=C.querySelector("h3"),Y=C.querySelector("p"),w=document.getElementById("mdlCard"),Z=w.querySelector(".modal-title"),ee=document.getElementById("mdlCardImg"),j=document.getElementById("mdlCardDelete"),L=document.getElementById("mdlCardFav"),c=new Map;c.set(0,{name:"admin",pfp_url:"pfp-admin.jpg",is_staff:!0,is_admin:!0});let S=1;const a=[];let o=null,B=null;const x=e=>{c.set(S,e),S++},te=()=>{[{name:"belyash",pfp_url:"pfp-belyash.jpg",is_staff:!1,is_admin:!1},{name:"chernysh",pfp_url:"pfp-chernysh.jpg",is_staff:!1,is_admin:!1},{name:"lazaga",pfp_url:"pfp-lazaga.jpg",is_staff:!1,is_admin:!1},{name:"liberty",pfp_url:"pfp-liberty.jpg",is_staff:!1,is_admin:!1},{name:"lopouh",pfp_url:"pfp-lopouh.jpg",is_staff:!1,is_admin:!1},{name:"smol",pfp_url:"pfp-smol.jpg",is_staff:!1,is_admin:!1},{name:"tux",pfp_url:"pfp-tux.jpg",is_staff:!1,is_admin:!1}].forEach(e=>{x(e)}),[{title:"Томас",author:0,url:"cat0.jpg",favBy:new Set},{title:"Рыжик",author:0,url:"cat1.jpg",favBy:new Set},{title:"Bar$ik",author:7,url:"cat2.jpg",favBy:new Set},{title:"Сажа Печная",author:7,url:"cat3.jpg",favBy:new Set},{title:"Молния",author:3,url:"cat4.jpg",favBy:new Set},{title:"Черныш",author:2,url:"cat5.jpg",favBy:new Set},{title:"Мурзик",author:7,url:"cat6.jpg",favBy:new Set}].forEach(e=>{a.push(e)})},ne=(e,t)=>{for(let n=0;n<e.length;n++)t(e.item(n))},le=e=>o===null?!1:e.favBy.has(o),re=e=>{const t=o===null?void 0:c.get(o);return t===void 0?!1:t.is_staff||t.is_admin?!0:o===e.author},oe=()=>o!==null,se=()=>{const e=o===null?void 0:c.get(o);return e===void 0?!1:e.is_staff},N=e=>{const t=new Map;return a.forEach(n=>{if(!n.title.includes(e))return;let l=t.get(n.author);l===void 0&&(l=[],t.set(n.author,l)),l.push(n)}),new Map([...t.entries()].sort())},k=()=>{T.classList.remove("show")},P=e=>{T.classList.add("show"),ne(T.children,t=>{t.style.display=e===t.id?"block":"none"})},ie=(e,t)=>{P(C.id),X.innerText=e,Y.innerHTML=t},U=e=>{P(w.id),ee.src=e.url,Z.innerText=e.title,j.style.display=re(e)?"initial":"none",L.style.display=oe()?"initial":"none",L.innerText=le(e)?"Удалить из избранного":"В избранное"},de=(e,t)=>{const l=document.importNode(q.content,!0).querySelector("tr"),r=l.querySelector("td"),d=r.querySelector("a"),f=r.querySelector("img");return f.src=e.pfp_url,d.setAttribute("id","caT"+e.name),d.innerText=`${e.name} (${t})`,l},ce=(e,t)=>{const l=document.importNode(q.content,!0).querySelector("tr"),r=l.querySelector("td"),d=r.querySelector("a"),f=r.querySelector("img");return r.removeChild(f),d.innerText=`${e} (${t})`,l},H=e=>{const n=document.importNode(J.content,!0).querySelector("div"),l=n.querySelector("img"),r=n.querySelector("p");return l.src=e.url,r.innerText=e.title,n.addEventListener("click",()=>{B=e,U(e)}),n},O=e=>{const t=[];let n=null;for(let l=0;l<e.length;l++){const r=document.createElement("td");r.appendChild(e.at(l)),n===null&&(n=document.createElement("tr")),n.appendChild(r),n.childElementCount>=3&&(t.push(n),n=null)}return n!==null&&t.push(n),t},ae=()=>{if(a.length===0){h.innerHTML='<tbody><tr><td><button type="button" id="btnTestData">Добавить тестовые данные</button></td></tr></tbody>',document.getElementById("btnTestData").addEventListener("click",()=>{te(),m()}),E.innerHTML="",s.style.display=o===null?"none":"flex";return}h.innerHTML="";const e=A.value;if(e===""&&o!==null){const n=[];if(a.forEach(l=>{l.favBy.has(o)&&n.push(l)}),n.length!==0){h.appendChild(ce("Избранное",n.length));const l=n.map(H);O(l).forEach(r=>{h.appendChild(r)})}}const t=N(e);t.forEach((n,l)=>{const r=c.get(l);if(r===void 0)return;h.appendChild(de(r,n.length));const d=n.map(H);O(d).forEach(f=>{h.appendChild(f)})}),I.innerText=a.length===0?"0 котов...":a.length+" котов!",s.style.display=o===null?"none":"flex",E.innerHTML="<h2>Коллекции</h2>",t.forEach((n,l)=>{const r=c.get(l);if(r===void 0)return;const d=document.createElement("p"),f=r.name;d.innerText=f,d.classList.add("toc-link"),d.addEventListener("click",()=>{document.getElementById("caT"+f).scrollIntoView({block:"center"})}),E.appendChild(d)})},ue=()=>{if(M.innerHTML="",!se())return;const e=N(""),t=document.importNode(Q.content,!0),l=t.querySelector("table").querySelector("tbody"),r=t.querySelectorAll("button"),d=r.item(0),f=r.item(1);M.appendChild(t);const F=[];d.addEventListener("click",()=>{x({name:"",pfp_url:"",is_admin:!1,is_staff:!1}),m()});const me=()=>{const p=[];F.forEach(u=>{p[u.uid]={name:u.elName.value,pfp_url:u.elUrl.value,is_admin:u.elIsAdmin.checked,is_staff:u.elIsStaff.checked}}),c.clear(),S=0,p.forEach((u,b)=>{c.set(b,u),S=Math.max(S,b)}),m()};f.addEventListener("click",me),c.forEach((p,u)=>{const b=document.importNode(W.content,!0).querySelector("tr"),g=b.querySelectorAll("td"),fe=g.item(0);fe.innerText=u.toString();const D=g.item(1).querySelector("input");D.value=p.name;const $=g.item(2),R=e.get(u);R===void 0?$.innerText="0":$.innerText=R.length.toString();const G=g.item(3).querySelector("input");G.value=p.pfp_url;const z=g.item(4).querySelector("input");z.checked=p.is_admin;const K=g.item(5).querySelector("input");K.checked=p.is_staff,g.item(6).querySelector("button").addEventListener("click",()=>{c.delete(u),m()}),l.appendChild(b),F.push({user:p,uid:u,elName:D,elUrl:G,elIsAdmin:z,elIsStaff:K})})},m=()=>{const e=[];a.forEach(t=>{c.get(t.author)!==void 0&&e.push(t)}),a.length=0,e.forEach(t=>a.push(t)),ae(),ue()};v.addEventListener("click",()=>{o=null,_.value!==""&&c.forEach((e,t)=>{e.name===_.value&&(o=t)}),m()}),V.addEventListener("click",()=>{const e=new Array;if(i.value===""&&e.push("<li>Название не указано</li>"),y.value===""&&e.push("<li>Ссылка не указана</li>"),e.length!==0){ie("Ошибка","Форма заполнена неправильно<ul>"+e.join("")+"</ul>");return}o!==null&&(a.push({title:i.value,author:o,url:y.value,favBy:new Set}),m(),i.value="",y.value="")}),A.addEventListener("input",m),T.addEventListener("click",e=>{e.target===T&&k()}),j.addEventListener("click",()=>{const e=a.indexOf(B);a.splice(e,1),k(),m()}),L.addEventListener("click",()=>{if(o===null)return;const e=B.favBy;e.has(o)?e.delete(o):e.add(o),U(B),m()}),m()})();
