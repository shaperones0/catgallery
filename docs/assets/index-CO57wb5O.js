(function(){const y=document.createElement("link").relList;if(y&&y.supports&&y.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))T(i);new MutationObserver(i=>{for(const c of i)if(c.type==="childList")for(const s of c.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&T(s)}).observe(document,{childList:!0,subtree:!0});function v(i){const c={};return i.integrity&&(c.integrity=i.integrity),i.referrerPolicy&&(c.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?c.credentials="include":i.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function T(i){if(i.ep)return;i.ep=!0;const c=v(i);fetch(i.href,c)}})();(()=>{const B=document.getElementById("fLoginUsername"),y=document.getElementById("fLoginSubmit"),v=document.getElementById("toc"),T=document.getElementById("catCounter"),i=document.getElementById("fAdd"),c=document.getElementById("fAddTitle"),s=document.getElementById("fAddUrl"),$=document.getElementById("fAddSubmit"),_=document.getElementById("fSearch"),g=document.getElementById("tblGallery").querySelector("tbody"),R=document.getElementById("tmpCard"),I=document.getElementById("tmpCategory"),C=document.getElementById("admin"),D=document.getElementById("tmpAdminTable"),G=document.getElementById("tmpAdminRow"),h=document.getElementById("modal"),S=document.getElementById("mdlMsg"),z=S.querySelector("h3"),K=S.querySelector("p"),q=document.getElementById("mdlCard"),V=q.querySelector(".modal-title"),J=document.getElementById("mdlCardImg"),L=document.getElementById("mdlCardDelete"),b=document.getElementById("mdlCardFav"),a=[{name:"admin",pfp_url:"pfp-admin.jpg",is_staff:!0,is_admin:!0},{name:"belyash",pfp_url:"pfp-belyash.jpg",is_staff:!1,is_admin:!1},{name:"chernysh",pfp_url:"pfp-chernysh.jpg",is_staff:!1,is_admin:!1},{name:"lazaga",pfp_url:"pfp-lazaga.jpg",is_staff:!1,is_admin:!1},{name:"liberty",pfp_url:"pfp-liberty.jpg",is_staff:!1,is_admin:!1},{name:"lopouh",pfp_url:"pfp-lopouh.jpg",is_staff:!1,is_admin:!1},{name:"smol",pfp_url:"pfp-smol.jpg",is_staff:!1,is_admin:!1},{name:"tux",pfp_url:"pfp-tux.jpg",is_staff:!1,is_admin:!1}],u=[{title:"Томас",author:0,url:"cat0.jpg",favBy:new Set},{title:"Рыжик",author:0,url:"cat1.jpg",favBy:new Set},{title:"Bar$ik",author:7,url:"cat2.jpg",favBy:new Set},{title:"Сажа Печная",author:7,url:"cat3.jpg",favBy:new Set},{title:"Молния",author:3,url:"cat4.jpg",favBy:new Set},{title:"Черныш",author:2,url:"cat5.jpg",favBy:new Set},{title:"Мурзик",author:7,url:"cat6.jpg",favBy:new Set}];let o=null,E=null;const Q=(e,l)=>{for(let t=0;t<e.length;t++)l(e.item(t))},W=e=>o===null?!1:e.favBy.has(o),X=e=>o===null?!1:a[o].is_staff||a[o].is_admin?!0:o===e.author,Y=()=>o!==null,Z=()=>o===null?!1:a[o].is_staff,A=e=>{const l=new Map;return u.forEach(t=>{if(!t.title.includes(e))return;let r=l.get(t.author);r===void 0&&(r=[],l.set(t.author,r)),r.push(t)}),new Map([...l.entries()].sort())},w=()=>{h.classList.remove("show")},M=e=>{h.classList.add("show"),Q(h.children,l=>{l.style.display=e===l.id?"block":"none"})},ee=(e,l)=>{M(S.id),z.innerText=e,K.innerHTML=l},j=e=>{M(q.id),J.src=e.url,V.innerText=e.title,L.style.display=X(e)?"initial":"none",b.style.display=Y()?"initial":"none",b.innerText=W(e)?"Удалить из избранного":"В избранное"},te=(e,l)=>{const r=document.importNode(I.content,!0).querySelector("tr"),n=r.querySelector("td"),d=n.querySelector("a"),p=n.querySelector("img");return p.src=e.pfp_url,d.setAttribute("id","caT"+e.name),d.innerText=`${e.name} (${l})`,r},ne=(e,l)=>{const r=document.importNode(I.content,!0).querySelector("tr"),n=r.querySelector("td"),d=n.querySelector("a"),p=n.querySelector("img");return n.removeChild(p),d.innerText=`${e} (${l})`,r},x=e=>{const t=document.importNode(R.content,!0).querySelector("div"),r=t.querySelector("img"),n=t.querySelector("p");return r.src=e.url,n.innerText=e.title,t.addEventListener("click",()=>{E=e,j(e)}),t},N=e=>{const l=[];let t=null;for(let r=0;r<e.length;r++){const n=document.createElement("td");n.appendChild(e.at(r)),t===null&&(t=document.createElement("tr")),t.appendChild(n),t.childElementCount>=3&&(l.push(t),t=null)}return t!==null&&l.push(t),l},le=()=>{g.innerHTML="";const e=_.value;if(e===""&&o!==null){const t=[];if(u.forEach(r=>{r.favBy.has(o)&&t.push(r)}),t.length!==0){g.appendChild(ne("Избранное",t.length));const r=t.map(x);N(r).forEach(n=>{g.appendChild(n)})}}const l=A(e);l.forEach((t,r)=>{g.appendChild(te(a[r],t.length));const n=t.map(x);N(n).forEach(d=>{g.appendChild(d)})}),T.innerText=u.length===0?"0 котов...":u.length+" котов!",i.style.display=o===null?"none":"flex",v.innerHTML="<h2>Содержание</h2>",l.forEach((t,r)=>{const n=document.createElement("p"),d=a[r].name;n.innerText=d,n.classList.add("toc-link"),n.addEventListener("click",()=>{document.getElementById("caT"+d).scrollIntoView({block:"center"})}),v.appendChild(n)})},re=()=>{if(C.innerHTML="",!Z())return;const e=A(""),l=document.importNode(D.content,!0),r=l.querySelector("table").querySelector("tbody");C.appendChild(l),a.forEach((n,d)=>{const p=document.importNode(G.content,!0).querySelector("tr"),f=p.querySelectorAll("td"),oe=f.item(0);oe.innerText=d.toString();const P=f.item(1).querySelector("input");P.value=n.name;const k=f.item(2),O=e.get(d);O===void 0?k.innerText="0":k.innerText=O.length.toString();const F=f.item(3).querySelector("input");F.value=n.pfp_url;const U=f.item(4).querySelector("input");U.checked=n.is_admin;const H=f.item(5).querySelector("input");H.checked=n.is_staff,f.item(6).querySelector("button").addEventListener("click",()=>{n.name=P.value,n.pfp_url=F.value,n.is_admin=U.checked,n.is_staff=H.checked,m()}),r.appendChild(p)})},m=()=>{le(),re()};y.addEventListener("click",()=>{o=null,a.forEach((e,l)=>{e.name===B.value&&(o=l)}),m()}),$.addEventListener("click",()=>{const e=new Array;if(c.value===""&&e.push("<li>Название не указано</li>"),s.value===""&&e.push("<li>Ссылка не указана</li>"),e.length!==0){ee("Ошибка","Форма заполнена неправильно<ul>"+e.join("")+"</ul>");return}o!==null&&(u.push({title:c.value,author:o,url:s.value,favBy:new Set}),m(),c.value="",s.value="")}),_.addEventListener("input",m),h.addEventListener("click",e=>{e.target===h&&w()}),L.addEventListener("click",()=>{const e=u.indexOf(E);u.splice(e,1),w(),m()}),b.addEventListener("click",()=>{if(o===null)return;const e=E.favBy;e.has(o)?e.delete(o):e.add(o),j(E),m()}),m()})();
